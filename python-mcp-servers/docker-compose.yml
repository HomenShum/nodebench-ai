version: '3.8'

services:
  openbb:
    build:
      context: ./openbb
      dockerfile: Dockerfile
    container_name: openbb-mcp-server
    ports:
      - "8001:8001"
    environment:
      - OPENBB_API_KEY=${OPENBB_API_KEY}
      - OPENBB_PORT=8001
      - OPENBB_HOST=0.0.0.0
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    env_file:
      - .env
    volumes:
      - ./openbb:/app
      - ./shared:/app/shared
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8001/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  core_agent:
    build:
      context: ./core_agent
      dockerfile: Dockerfile
    container_name: core-agent-mcp-server
    ports:
      - "8005:8005"
    environment:
      - CORE_AGENT_PORT=8005
      - CORE_AGENT_HOST=0.0.0.0
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    env_file:
      - .env
    volumes:
      - ./core_agent:/app
      - ./shared:/app/shared
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8005/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  research:
    build:
      context: ./research
      dockerfile: Dockerfile
    container_name: research-mcp-server
    ports:
      - "8002:8002"
    environment:
      - RESEARCH_PORT=8002
      - RESEARCH_HOST=0.0.0.0
      - CONVEX_URL=${CONVEX_URL}
      - MCP_SECRET=${MCP_SECRET:-nodebench_dev_secret}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    env_file:
      - .env
    volumes:
      - ./research:/app
      - ./shared:/app/shared
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8002/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  flicker_detection:
    build:
      context: ./flicker_detection
      dockerfile: Dockerfile
    container_name: flicker-detection-mcp-server
    ports:
      - "8006:8006"
    environment:
      - FLICKER_PORT=8006
      - FLICKER_HOST=0.0.0.0
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    env_file:
      - .env
    volumes:
      - ./flicker_detection:/app
      - ./shared:/app/shared
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8006/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  figma_flow:
    build:
      context: ./figma_flow
      dockerfile: Dockerfile
    container_name: figma-flow-mcp-server
    ports:
      - "8007:8007"
    environment:
      - FIGMA_FLOW_PORT=8007
      - FIGMA_FLOW_HOST=0.0.0.0
      - FIGMA_ACCESS_TOKEN=${FIGMA_ACCESS_TOKEN}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    env_file:
      - .env
    volumes:
      - ./figma_flow:/app
      - ./shared:/app/shared
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8007/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: mcp-servers-network
